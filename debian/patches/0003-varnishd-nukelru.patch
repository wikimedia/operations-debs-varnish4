From: Brandon Black <bblack@wikimedia.org>
Date: Tue, 05 Apr 2016 11:35:18 +0000
Subject: varnishd-nukelru

Log a message when EXP_NukeOne can't destroy an object.
---
 bin/varnishd/cache/cache_expire.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/bin/varnishd/cache/cache_expire.c b/bin/varnishd/cache/cache_expire.c
index 5c27d07..327a119 100644
--- a/bin/varnishd/cache/cache_expire.c
+++ b/bin/varnishd/cache/cache_expire.c
@@ -33,6 +33,7 @@
 #include "config.h"
 
 #include <stdlib.h>
+#include <stdio.h>
 
 #include "cache.h"
 
@@ -376,7 +377,9 @@ EXP_NukeOne(struct worker *wrk, struct lru *lru)
 	exp_mail_it(oc);
 
 	VSLb(wrk->vsl, SLT_ExpKill, "LRU x=%u", ObjGetXID(wrk, oc));
-	(void)HSH_DerefObjCore(wrk, &oc);
+	oc2 = oc;
+	if (HSH_DerefObjCore(wrk, &oc) != 0)
+		printf("Could not destroy object %u in EXP_NukeOne\n", ObjGetXID(wrk, oc2));
 	return (1);
 }
 
